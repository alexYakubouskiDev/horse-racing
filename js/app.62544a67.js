(function(){"use strict";var t={5677:function(t,n,s){var e=s(6848),r=function(){var t=this,n=t._self._c;return n("MainLayout")},i=[],o=function(){var t=this,n=t._self._c;return n("main",{staticClass:"layout"},[n("div",{staticClass:"layout__header"},[n("ControlPanel")],1),t.isIdle?n("EmptyState"):n("div",{staticClass:"layout__content"},[n("div",{staticClass:"layout__left"},[n("AllHorses")],1),n("div",{staticClass:"layout__center"},[n("RaceTrack")],1),n("div",{staticClass:"layout__right"},[n("ProgramResults",{attrs:{rounds:t.rounds,currentRound:t.currentRound}})],1)])],1)},a=[],u=s(3518),l=function(){var t=this,n=t._self._c;return n("div",{staticClass:"controls"},[n("div",{staticClass:"controls__title"},[t._v("Horse Racing")]),n("div",{staticClass:"controls__actions"},[n("button",{attrs:{disabled:t.isRunning},on:{click:t.generate}},[t._v(" "+t._s(t.primaryLabel)+" ")]),n("button",{attrs:{disabled:!t.canToggle||t.isTransitioning},on:{click:t.toggle}},[t._v(" "+t._s(t.toggleLabel)+" ")])])])},c=[],d={name:"ControlPanel",computed:{...(0,u.aH)("game",["isTransitioning"]),...(0,u.L8)("game",["isRunning","isPaused","canToggle"]),primaryLabel(){return"Generate program"},toggleLabel(){return this.isPaused?"Resume":this.isRunning?"Pause":"Start"}},methods:{...(0,u.i0)("game",{generate:"generateGame",toggle:"toggleRun"})}},h=d,m=s(1656),_=(0,m.A)(h,l,c,!1,null,"e8e4a4cc",null),f=_.exports,p=function(){var t=this,n=t._self._c;return t.hasRound?n("div",{staticClass:"race-track"},[n("div",{staticClass:"race-track__grid"},[n("div",{staticClass:"race-track__lanes"},t._l(t.horsesPerRound,function(s){return n("div",{key:s,staticClass:"race-track__lane-number"},[t._v(" "+t._s(s)+" ")])}),0),n("div",{staticClass:"race-track__track"},[n("RaceRound",{attrs:{round:t.currentRoundData,isRunning:t.isRunning},on:{finished:t.roundFinished}}),n("div",{staticClass:"race-track__finish-line"}),n("div",{staticClass:"race-track__finish-label"},[t._v("FINISH")])],1)]),n("div",{staticClass:"race-track__lap-label"},[t._v(" "+t._s(t.roundLabel)+" Lap "+t._s(t.currentRoundData.distance)+"m ")])]):t._e()},v=[],g=function(){var t=this,n=t._self._c;return n("div",{staticClass:"round"},t._l(t.round.horses,function(s){return n("div",{key:s.id,ref:"lanes",refInFor:!0,staticClass:"round__lane"},[n("div",{ref:"horses",refInFor:!0,staticClass:"round__horse",style:{transform:`translateX(${t.positions[s.id]||0}px) scaleX(-1)`}},[n("img",{staticClass:"round__horse-icon",attrs:{src:t.horseIcon}})])])}),0)},R=[],S=(s(8111),s(7588),s(1701),s.p+"img/horse.5c4068db.svg"),T={name:"RaceRound",computed:{horseIcon(){return S}},props:{round:Object,isRunning:Boolean},data(){return{startTime:null,animationFrame:null,positions:{},maxDuration:0,resultData:[],finishedOnce:!1,trackWidth:0,horseWidth:0,pausedAt:null,totalPausedTime:0}},watch:{isRunning(t,n){!t&&n&&this.pause(),t&&!n&&this.resume()},"round.result":{immediate:!0,handler(t){t&&this.isRunning&&this.startAnimation(t)}},round:{immediate:!0,handler(){this.positions={},this.finishedOnce=!1,this.pausedAt=null,this.totalPausedTime=0,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}}},methods:{startAnimation(t){this.finishedOnce=!1,this.totalPausedTime=0,this.pausedAt=null,this.startTime=performance.now(),this.maxDuration=1e3*Math.max(...t.map(t=>t.time)),this.positions={},this.resultData=t,this.$nextTick(()=>{const t=this.$refs.lanes[0],n=this.$refs.horses[0];this.trackWidth=t.offsetWidth,this.horseWidth=n.offsetWidth,this.loop()})},loop(){const t=performance.now(),n=t-this.startTime-this.totalPausedTime,s=this.trackWidth-this.horseWidth;this.resultData.forEach(t=>{const e=Math.min(n/(1e3*t.time),1),r=e*s;this.$set(this.positions,t.id,r)}),n<this.maxDuration?this.animationFrame=requestAnimationFrame(()=>this.loop()):this.finish()},pause(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null,this.pausedAt=performance.now())},resume(){this.pausedAt&&(this.totalPausedTime+=performance.now()-this.pausedAt,this.pausedAt=null,this.loop())},finish(){this.finishedOnce||(this.finishedOnce=!0,cancelAnimationFrame(this.animationFrame),this.$emit("finished"))}},beforeDestroy(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)}},y=T,C=(0,m.A)(y,g,R,!1,null,"1823b700",null),A=C.exports;const E={TOTAL_ROUNDS:6,ROUND_DISTANCES:[1200,1400,1600,1800,2e3,2200],HORSES_PER_ROUND:10,HORSES_TOTAL_COUNT:20,TIME_SCALE:.01,DELAY_BETWEEN_ROUNDS:500};function O(t){const n=t%100;if(n>=11&&n<=13)return`${t}th`;switch(t%10){case 1:return`${t}st`;case 2:return`${t}nd`;case 3:return`${t}rd`;default:return`${t}th`}}var b={name:"RaceTrack",components:{RaceRound:A},computed:{...(0,u.aH)("races",["rounds"]),...(0,u.L8)("game",["isRunning","currentRound"]),...(0,u.L8)("races",["currentRoundData"]),horsesPerRound(){return E.HORSES_PER_ROUND},roundLabel(){return O(this.currentRound)},hasRound(){return Boolean(this.currentRoundData)}},methods:{...(0,u.i0)("game",["roundFinished"])}},N=b,k=(0,m.A)(N,p,v,!1,null,"71fe1ae0",null),L=k.exports,w=function(){var t=this,n=t._self._c;return n("div",{staticClass:"program-results"},[n("div",{staticClass:"program-results__columns"},[n("SectionPanel",{attrs:{title:"Program",variant:"program"}},[n("RoundsList",{attrs:{rounds:t.rounds,mode:"program"}})],1),n("SectionPanel",{attrs:{title:"Results",variant:"results"}},[n("RoundsList",{attrs:{rounds:t.finishedRounds,mode:"results",autoScroll:""}})],1)],1)])},D=[],P=function(){var t=this,n=t._self._c;return n("div",{ref:"roundsList",staticClass:"rounds"},t._l(t.rounds,function(s){return n("RoundBlock",{key:s.round,attrs:{round:s,mode:t.mode}})}),1)},U=[],F=function(){var t=this,n=t._self._c;return n("div",{staticClass:"round"},[n("div",{staticClass:"round__title"},[t._v(t._s(t.roundLabel)+" Lap "+t._s(t.round.distance)+"m")]),n("div",{staticClass:"round__table",attrs:{role:"table"}},[t._m(0),t._l(t.rows,function(s,e){return n("div",{key:s.id,staticClass:"round__row",attrs:{role:"row"}},[n("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v(" "+t._s("program"===t.mode?e+1:s.place)+" ")]),n("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v(t._s(s.name))])])})],2)])},H=[function(){var t=this,n=t._self._c;return n("div",{staticClass:"round__row round__row--header",attrs:{role:"rowgroup"}},[n("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v("Position")]),n("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v("Name")])])}],x={name:"RoundBlock",props:{round:{type:Object,required:!0},mode:{type:String,required:!0,validator:t=>["program","results"].includes(t)}},computed:{rows(){return"program"===this.mode?this.round.horses:this.round.result},roundLabel(){return O(this.round.round)}}},I=x,$=(0,m.A)(I,F,H,!1,null,"65ff143c",null),B=$.exports,M={name:"RoundsList",components:{RoundBlock:B},props:{rounds:Array,mode:{type:String,default:"program"},autoScroll:{type:Boolean,default:!1}},watch:{rounds(){this.autoScroll&&this.$nextTick(()=>{const t=this.$refs.roundsList;t&&(t.scrollTop=t.scrollHeight)})}}},W=M,j=(0,m.A)(W,P,U,!1,null,"79866268",null),q=j.exports,G=function(){var t=this,n=t._self._c;return n("div",{staticClass:"section-panel",class:{[`section-panel--${t.variant}`]:!0}},[n("div",{staticClass:"section-panel__header",attrs:{role:"heading","aria-level":"2"}},[t._v(" "+t._s(t.title)+" ")]),n("div",{staticClass:"section-panel__body"},[t._t("default")],2)])},X=[],Y={name:"SectionPanel",props:{title:String,variant:{type:String,required:!0,validator:t=>["program","results","horses"].includes(t)}}},z=Y,K=(0,m.A)(z,G,X,!1,null,"4c491788",null),J=K.exports,Q={name:"ProgramResults",components:{SectionPanel:J,RoundsList:q},props:{rounds:{type:Array,required:!0},currentRound:{type:Number,required:!0}},computed:{...(0,u.L8)("races",["finishedRounds"])}},V=Q,Z=(0,m.A)(V,w,D,!1,null,"8db3fc46",null),tt=Z.exports,nt=function(){var t=this,n=t._self._c;return n("div",{staticClass:"horse-list"},[n("SectionPanel",{attrs:{title:"Horse List (1â€“20)",variant:"horses"}},[n("HorseList",{attrs:{horses:t.list}})],1)],1)},st=[],et=function(){var t=this,n=t._self._c;return n("div",{staticClass:"horse-list",attrs:{role:"table"}},[t._m(0),n("div",{staticClass:"horse-list__body",attrs:{role:"rowgroup"}},t._l(t.horses,function(s){return n("div",{key:s.id,staticClass:"horse-list__row",attrs:{role:"row"}},[n("div",{attrs:{role:"cell"}},[t._v(t._s(s.name))]),n("div",{attrs:{role:"cell"}},[t._v(t._s(s.condition))]),n("div",{attrs:{role:"cell"}},[t._v(t._s(s.color))])])}),0)])},rt=[function(){var t=this,n=t._self._c;return n("div",{staticClass:"horse-list__header",attrs:{role:"rowgroup"}},[n("div",{attrs:{role:"columnheader"}},[t._v("Name")]),n("div",{attrs:{role:"columnheader"}},[t._v("Condition")]),n("div",{attrs:{role:"columnheader"}},[t._v("Color")])])}],it={name:"HorseList",props:{horses:{type:Array,required:!0}}},ot=it,at=(0,m.A)(ot,et,rt,!1,null,"6330f0a5",null),ut=at.exports,lt={name:"AllHorses",components:{SectionPanel:J,HorseList:ut},computed:{...(0,u.aH)("horses",["list"])}},ct=lt,dt=(0,m.A)(ct,nt,st,!1,null,null,null),ht=dt.exports,mt=function(){var t=this;t._self._c;return t._m(0)},_t=[function(){var t=this,n=t._self._c;return n("div",{staticClass:"empty-state"},[n("div",{staticClass:"empty-state__content"},[n("div",{staticClass:"empty-state__title"},[t._v("Horse Racing Simulator")]),n("div",{staticClass:"empty-state__hint"},[t._v('Press "Generate program" to start')])])])}],ft={},pt=(0,m.A)(ft,mt,_t,!1,null,"2c917e85",null),vt=pt.exports,gt={components:{ControlPanel:f,RaceTrack:L,ProgramResults:tt,AllHorses:ht,EmptyState:vt},computed:{...(0,u.aH)("races",["rounds"]),...(0,u.L8)("game",["isIdle","currentRound"])}},Rt=gt,St=(0,m.A)(Rt,o,a,!1,null,"db08cc8e",null),Tt=St.exports,yt={components:{MainLayout:Tt}},Ct=yt,At=(0,m.A)(Ct,r,i,!1,null,null,null),Et=At.exports;const Ot={idle:"idle",ready:"ready",running:"running",paused:"paused",finished:"finished"},bt={namespaced:!0,state:()=>({status:Ot.idle,currentRound:1,isTransitioning:!1}),mutations:{SET_STATUS(t,n){t.status=n},SET_CURRENT_ROUND(t,n){t.currentRound=n},SET_TRANSITION(t,n){t.isTransitioning=n}},actions:{generateGame({commit:t,dispatch:n}){n("horses/createHorses",null,{root:!0}),n("races/initRounds",null,{root:!0}),t("SET_STATUS",Ot.ready),t("SET_CURRENT_ROUND",1)},toggleRun({state:t,commit:n,dispatch:s}){switch(t.status){case Ot.ready:n("SET_STATUS",Ot.running),s("races/runRound",{round:t.currentRound},{root:!0});break;case Ot.running:n("SET_STATUS",Ot.paused);break;case Ot.paused:n("SET_STATUS",Ot.running);break;default:console.warn("Unknown game status:",t.status)}},async roundFinished({state:t,commit:n,dispatch:s}){if(n("races/FINISH_ROUND",t.currentRound,{root:!0}),t.currentRound>=E.TOTAL_ROUNDS)return void n("SET_STATUS",Ot.finished);n("SET_TRANSITION",!0),await new Promise(t=>setTimeout(t,E.DELAY_BETWEEN_ROUNDS));const e=t.currentRound+1;n("SET_CURRENT_ROUND",e),n("SET_TRANSITION",!1),s("races/runRound",{round:e},{root:!0})}},getters:{isIdle:t=>t.status===Ot.idle,isReady:t=>t.status===Ot.ready,isRunning:t=>t.status===Ot.running,isFinished:t=>t.status===Ot.finished,currentRound:t=>t.currentRound,isPaused:t=>t.status===Ot.paused,canToggle:t=>t.status===Ot.ready||t.status===Ot.running||t.status===Ot.paused}};s(2489),s(116);const Nt=14,kt=18,Lt=1,wt=100,Dt=.6,Pt=.7,Ut=.6;function Ft({speed:t,condition:n}){const s=t*Dt,e=Pt+n/wt*Ut;return s*e}function Ht(t,n){return t/n*E.TIME_SCALE}function xt(t,n){const s=t.map(t=>{const s=Ft(t),e=Ht(n,s);return{...t,speed:s,time:e}});return s.sort((t,n)=>t.time-n.time),s.map((t,n)=>({...t,place:n+1}))}function It(t,n){return Math.floor(Math.random()*(n-t+1))+t}function $t(t){const n=[...t];for(let s=n.length-1;s>0;s--){const t=Math.floor(Math.random()*(s+1)),e=n[s];n[s]=n[t],n[t]=e}return n}const Bt={namespaced:!0,state:()=>({rounds:[]}),mutations:{SET_ROUNDS(t,n){t.rounds=n},SET_RESULT(t,{round:n,result:s}){const e=t.rounds.find(t=>t.round===n);e&&(e.result=s)},SET_ROUND_HORSES(t,{round:n,horses:s}){const e=t.rounds.find(t=>t.round===n);e&&(e.horses=s)},FINISH_ROUND(t,n){const s=t.rounds.find(t=>t.round===n);s&&(s.finished=!0)}},actions:{initRounds({commit:t,rootState:n}){const s=n.horses.list,e=E.ROUND_DISTANCES.map((t,n)=>{const e=$t(s).slice(0,E.HORSES_PER_ROUND);return{round:n+1,distance:t,horses:e,result:null,finished:!1}});t("SET_ROUNDS",e)},runRound({state:t,commit:n},{round:s}){const e=t.rounds.find(t=>t.round===s);if(!e)return;const r=xt(e.horses,e.distance);n("SET_RESULT",{round:s,result:r})}},getters:{roundByNumber:t=>n=>t.rounds.find(t=>t.round===n),currentRoundData:(t,n,s)=>t.rounds.find(t=>t.round===s.game.currentRound),finishedRounds:t=>t.rounds.filter(t=>t.finished)}};s(4114);const Mt=["red","green","yellow","blue","orange","purple","cyan","magenta","lime","pink","teal","lavender","brown","beige","maroon","mint","olive","coral","navy","grey"],Wt=["Thunder","Storm","Blaze","Shadow","Rocket","Comet","Flash","Tornado","Spirit","Ghost","Lightning","Arrow","Fury","Phantom","Rider","Bolt","Wind","Steel","Night","King"];function jt(t,n,s){return{id:t,name:s,color:n,speed:It(Nt,kt),condition:It(Lt,wt)}}const qt={namespaced:!0,state:()=>({list:[]}),mutations:{SET_HORSES(t,n){t.list=n}},actions:{createHorses({commit:t}){const n=[];for(let s=0;s<E.HORSES_TOTAL_COUNT;s++)n.push(jt(s+1,Mt[s%Mt.length],Wt[s%Wt.length]));t("SET_HORSES",n)}}};e.Ay.use(u.Ay);var Gt=new u.Ay.Store({modules:{game:bt,races:Bt,horses:qt}});e.Ay.config.productionTip=!1,new e.Ay({store:Gt,render:t=>t(Et)}).$mount("#app")}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e].call(i.exports,i,i.exports,s),i.exports}s.m=t,function(){var t=[];s.O=function(n,e,r,i){if(!e){var o=1/0;for(c=0;c<t.length;c++){e=t[c][0],r=t[c][1],i=t[c][2];for(var a=!0,u=0;u<e.length;u++)(!1&i||o>=i)&&Object.keys(s.O).every(function(t){return s.O[t](e[u])})?e.splice(u--,1):(a=!1,i<o&&(o=i));if(a){t.splice(c--,1);var l=r();void 0!==l&&(n=l)}}return n}i=i||0;for(var c=t.length;c>0&&t[c-1][2]>i;c--)t[c]=t[c-1];t[c]=[e,r,i]}}(),function(){s.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(n,{a:n}),n}}(),function(){s.d=function(t,n){for(var e in n)s.o(n,e)&&!s.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)}}(),function(){s.p="/horse-racing/"}(),function(){var t={524:0};s.O.j=function(n){return 0===t[n]};var n=function(n,e){var r,i,o=e[0],a=e[1],u=e[2],l=0;if(o.some(function(n){return 0!==t[n]})){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(u)var c=u(s)}for(n&&n(e);l<o.length;l++)i=o[l],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return s.O(c)},e=self["webpackChunkhorse_racing"]=self["webpackChunkhorse_racing"]||[];e.forEach(n.bind(null,0)),e.push=n.bind(null,e.push.bind(e))}();var e=s.O(void 0,[504],function(){return s(5677)});e=s.O(e)})();
//# sourceMappingURL=app.62544a67.js.map