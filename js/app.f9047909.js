(function(){"use strict";var t={7034:function(t,s,n){var e=n(6848),r=function(){var t=this,s=t._self._c;return s("MainLayout")},i=[],o=function(){var t=this,s=t._self._c;return s("div",{staticClass:"layout"},[s("div",{staticClass:"layout__header"},[s("ControlPanel")],1),t.isIdle?s("EmptyState"):s("div",{staticClass:"layout__content"},[s("div",{staticClass:"layout__left"},[s("AllHorses")],1),s("div",{staticClass:"layout__center"},[s("RaceTrack")],1),s("div",{staticClass:"layout__right"},[s("ProgramResults",{attrs:{rounds:t.rounds,currentRound:t.currentRound}})],1)])],1)},a=[],u=n(3518),l=function(){var t=this,s=t._self._c;return s("div",{staticClass:"controls"},[s("div",{staticClass:"controls__title"},[t._v("Horse Racing")]),s("div",{staticClass:"controls__actions"},[s("button",{attrs:{disabled:t.isRunning},on:{click:t.generate}},[t._v(" "+t._s(t.primaryLabel)+" ")]),s("button",{attrs:{disabled:!t.canToggle||t.isTransitioning},on:{click:t.toggle}},[t._v(" "+t._s(t.toggleLabel)+" ")])])])},c=[],d={name:"ControlPanel",computed:{...(0,u.aH)("game",["isTransitioning"]),...(0,u.L8)("game",["isRunning","isPaused","canToggle"]),primaryLabel(){return"Generate program"},toggleLabel(){return this.isPaused?"Resume":this.isRunning?"Pause":"Start"}},methods:{...(0,u.i0)("game",{generate:"generateGame",toggle:"toggleRun"})}},h=d,_=n(1656),m=(0,_.A)(h,l,c,!1,null,"e8e4a4cc",null),f=m.exports,p=function(){var t=this,s=t._self._c;return t.hasRound?s("div",{staticClass:"race-track"},[s("div",{staticClass:"race-track__grid"},[s("div",{staticClass:"race-track__lanes"},t._l(t.horsesPerRound,function(n){return s("div",{key:n,staticClass:"race-track__lane-number"},[t._v(" "+t._s(n)+" ")])}),0),s("div",{staticClass:"race-track__track"},[s("RaceRound",{attrs:{round:t.currentRoundData,isRunning:t.isRunning},on:{finished:t.roundFinished}}),s("div",{staticClass:"race-track__finish-line"}),s("div",{staticClass:"race-track__finish-label"},[t._v("FINISH")])],1)]),s("div",{staticClass:"race-track__lap-label"},[t._v(" "+t._s(t.roundLabel)+" Lap "+t._s(t.currentRoundData.distance)+"m ")])]):t._e()},v=[],g=function(){var t=this,s=t._self._c;return s("div",{staticClass:"round"},t._l(t.round.horses,function(n){return s("div",{key:n.id,ref:"lanes",refInFor:!0,staticClass:"round__lane"},[s("div",{ref:"horses",refInFor:!0,staticClass:"round__horse",style:{transform:`translateX(${t.positions[n.id]||0}px) scaleX(-1)`}},[s("img",{staticClass:"round__horse-icon",attrs:{src:t.horseIcon}})])])}),0)},R=[],S=(n(8111),n(7588),n(1701),n.p+"img/horse.5c4068db.svg"),T={name:"RaceRound",computed:{horseIcon(){return S}},props:{round:Object,isRunning:Boolean},data(){return{startTime:null,animationFrame:null,positions:{},maxDuration:0,resultData:[],finishedOnce:!1,trackWidth:0,horseWidth:0,pausedAt:null,totalPausedTime:0}},watch:{isRunning(t,s){!t&&s&&this.pause(),t&&!s&&this.resume()},"round.result":{immediate:!0,handler(t){t&&this.isRunning&&this.startAnimation(t)}},round:{immediate:!0,handler(){this.positions={},this.finishedOnce=!1,this.pausedAt=null,this.totalPausedTime=0,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}}},methods:{startAnimation(t){this.finishedOnce=!1,this.totalPausedTime=0,this.pausedAt=null,this.startTime=performance.now(),this.maxDuration=1e3*Math.max(...t.map(t=>t.time)),this.positions={},this.resultData=t,this.$nextTick(()=>{const t=this.$refs.lanes[0],s=this.$refs.horses[0];this.trackWidth=t.offsetWidth,this.horseWidth=s.offsetWidth,this.loop()})},loop(){const t=performance.now(),s=t-this.startTime-this.totalPausedTime,n=this.trackWidth-this.horseWidth;this.resultData.forEach(t=>{const e=Math.min(s/(1e3*t.time),1),r=e*n;this.$set(this.positions,t.id,r)}),s<this.maxDuration?this.animationFrame=requestAnimationFrame(()=>this.loop()):this.finish()},pause(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null,this.pausedAt=performance.now())},resume(){this.pausedAt&&(this.totalPausedTime+=performance.now()-this.pausedAt,this.pausedAt=null,this.loop())},finish(){this.finishedOnce||(this.finishedOnce=!0,cancelAnimationFrame(this.animationFrame),this.$emit("finished"))}},beforeDestroy(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)}},y=T,C=(0,_.A)(y,g,R,!1,null,"1823b700",null),A=C.exports;const E={TOTAL_ROUNDS:6,ROUND_DISTANCES:[1200,1400,1600,1800,2e3,2200],HORSES_PER_ROUND:10,HORSES_TOTAL_COUNT:20,TIME_SCALE:.01,DELAY_BETWEEN_ROUNDS:500};function O(t){const s=t%100;if(s>=11&&s<=13)return`${t}th`;switch(t%10){case 1:return`${t}st`;case 2:return`${t}nd`;case 3:return`${t}rd`;default:return`${t}th`}}var b={name:"RaceTrack",components:{RaceRound:A},computed:{...(0,u.aH)("races",["rounds"]),...(0,u.L8)("game",["isRunning","currentRound"]),...(0,u.L8)("races",["currentRoundData"]),horsesPerRound(){return E.HORSES_PER_ROUND},roundLabel(){return O(this.currentRound)},hasRound(){return Boolean(this.currentRoundData)}},methods:{...(0,u.i0)("game",["roundFinished"])}},N=b,k=(0,_.A)(N,p,v,!1,null,"71fe1ae0",null),L=k.exports,w=function(){var t=this,s=t._self._c;return s("div",{staticClass:"program-results"},[s("div",{staticClass:"program-results__columns"},[s("SectionPanel",{attrs:{title:"Program",variant:"program"}},[s("RoundsList",{attrs:{rounds:t.rounds,mode:"program"}})],1),s("SectionPanel",{attrs:{title:"Results",variant:"results"}},[s("RoundsList",{attrs:{rounds:t.finishedRounds,mode:"results",autoScroll:""}})],1)],1)])},D=[],P=function(){var t=this,s=t._self._c;return s("div",{ref:"roundsList",staticClass:"rounds"},t._l(t.rounds,function(n){return s("RoundBlock",{key:n.round,attrs:{round:n,mode:t.mode}})}),1)},U=[],F=function(){var t=this,s=t._self._c;return s("div",{staticClass:"round"},[s("div",{staticClass:"round__title"},[t._v(t._s(t.roundLabel)+" Lap "+t._s(t.round.distance)+"m")]),s("div",{staticClass:"round__table",attrs:{role:"table"}},[t._m(0),t._l(t.rows,function(n,e){return s("div",{key:n.id,staticClass:"round__row",attrs:{role:"row"}},[s("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v(" "+t._s("program"===t.mode?e+1:n.place)+" ")]),s("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v(t._s(n.name))])])})],2)])},H=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"round__row round__row--header",attrs:{role:"rowgroup"}},[s("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v("Position")]),s("div",{staticClass:"round__cell",attrs:{role:"cell"}},[t._v("Name")])])}],x={name:"RoundBlock",props:{round:{type:Object,required:!0},mode:{type:String,required:!0,validator:t=>["program","results"].includes(t)}},computed:{rows(){return"program"===this.mode?this.round.horses:this.round.result},roundLabel(){return O(this.round.round)}}},I=x,$=(0,_.A)(I,F,H,!1,null,"65ff143c",null),B=$.exports,M={name:"RoundsList",components:{RoundBlock:B},props:{rounds:Array,mode:{type:String,default:"program"},autoScroll:{type:Boolean,default:!1}},watch:{rounds(){this.autoScroll&&this.$nextTick(()=>{const t=this.$refs.roundsList;t&&(t.scrollTop=t.scrollHeight)})}}},W=M,j=(0,_.A)(W,P,U,!1,null,"79866268",null),q=j.exports,G=function(){var t=this,s=t._self._c;return s("div",{staticClass:"section-panel",class:{[`section-panel--${t.variant}`]:!0}},[s("div",{staticClass:"section-panel__header",attrs:{role:"heading","aria-level":"2"}},[t._v(" "+t._s(t.title)+" ")]),s("div",{staticClass:"section-panel__body"},[t._t("default")],2)])},X=[],Y={name:"SectionPanel",props:{title:String,variant:{type:String,required:!0,validator:t=>["program","results","horses"].includes(t)}}},z=Y,K=(0,_.A)(z,G,X,!1,null,"4c491788",null),J=K.exports,Q={name:"ProgramResults",components:{SectionPanel:J,RoundsList:q},props:{rounds:{type:Array,required:!0},currentRound:{type:Number,required:!0}},computed:{...(0,u.L8)("races",["finishedRounds"])}},V=Q,Z=(0,_.A)(V,w,D,!1,null,"8db3fc46",null),tt=Z.exports,st=function(){var t=this,s=t._self._c;return s("div",{staticClass:"horse-list"},[s("SectionPanel",{attrs:{title:"Horse List (1â€“20)",variant:"horses"}},[s("HorseList",{attrs:{horses:t.list}})],1)],1)},nt=[],et=function(){var t=this,s=t._self._c;return s("div",{staticClass:"horse-list",attrs:{role:"table"}},[t._m(0),s("div",{staticClass:"horse-list__body",attrs:{role:"rowgroup"}},t._l(t.horses,function(n){return s("div",{key:n.id,staticClass:"horse-list__row",attrs:{role:"row"}},[s("div",{attrs:{role:"cell"}},[t._v(t._s(n.name))]),s("div",{attrs:{role:"cell"}},[t._v(t._s(n.condition))]),s("div",{attrs:{role:"cell"}},[t._v(t._s(n.color))])])}),0)])},rt=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"horse-list__header",attrs:{role:"rowgroup"}},[s("div",{attrs:{role:"columnheader"}},[t._v("Name")]),s("div",{attrs:{role:"columnheader"}},[t._v("Condition")]),s("div",{attrs:{role:"columnheader"}},[t._v("Color")])])}],it={name:"HorseList",props:{horses:{type:Array,required:!0}}},ot=it,at=(0,_.A)(ot,et,rt,!1,null,"6330f0a5",null),ut=at.exports,lt={name:"AllHorses",components:{SectionPanel:J,HorseList:ut},computed:{...(0,u.aH)("horses",["list"])}},ct=lt,dt=(0,_.A)(ct,st,nt,!1,null,null,null),ht=dt.exports,_t=function(){var t=this;t._self._c;return t._m(0)},mt=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"empty-state"},[s("div",{staticClass:"empty-state__content"},[s("div",{staticClass:"empty-state__title"},[t._v("Horse Racing Simulator")]),s("div",{staticClass:"empty-state__hint"},[t._v('Press "Generate program" to start')])])])}],ft={},pt=(0,_.A)(ft,_t,mt,!1,null,"2c917e85",null),vt=pt.exports,gt={components:{ControlPanel:f,RaceTrack:L,ProgramResults:tt,AllHorses:ht,EmptyState:vt},computed:{...(0,u.aH)("races",["rounds"]),...(0,u.L8)("game",["isIdle","currentRound"])}},Rt=gt,St=(0,_.A)(Rt,o,a,!1,null,"ec7a0da2",null),Tt=St.exports,yt={components:{MainLayout:Tt}},Ct=yt,At=(0,_.A)(Ct,r,i,!1,null,null,null),Et=At.exports;const Ot={idle:"idle",ready:"ready",running:"running",paused:"paused",finished:"finished"},bt={namespaced:!0,state:()=>({status:Ot.idle,currentRound:1,isTransitioning:!1}),mutations:{SET_STATUS(t,s){t.status=s},SET_CURRENT_ROUND(t,s){t.currentRound=s},SET_TRANSITION(t,s){t.isTransitioning=s}},actions:{generateGame({commit:t,dispatch:s}){s("horses/createHorses",null,{root:!0}),s("races/initRounds",null,{root:!0}),t("SET_STATUS",Ot.ready),t("SET_CURRENT_ROUND",1)},toggleRun({state:t,commit:s,dispatch:n}){switch(t.status){case Ot.ready:s("SET_STATUS",Ot.running),n("races/runRound",{round:t.currentRound},{root:!0});break;case Ot.running:s("SET_STATUS",Ot.paused);break;case Ot.paused:s("SET_STATUS",Ot.running);break;default:console.warn("Unknown game status:",t.status)}},async roundFinished({state:t,commit:s,dispatch:n}){if(s("races/FINISH_ROUND",t.currentRound,{root:!0}),t.currentRound>=E.TOTAL_ROUNDS)return void s("SET_STATUS",Ot.finished);s("SET_TRANSITION",!0),await new Promise(t=>setTimeout(t,E.DELAY_BETWEEN_ROUNDS));const e=t.currentRound+1;s("SET_CURRENT_ROUND",e),s("SET_TRANSITION",!1),n("races/runRound",{round:e},{root:!0})}},getters:{isIdle:t=>t.status===Ot.idle,isReady:t=>t.status===Ot.ready,isRunning:t=>t.status===Ot.running,isFinished:t=>t.status===Ot.finished,currentRound:t=>t.currentRound,isPaused:t=>t.status===Ot.paused,canToggle:t=>t.status===Ot.ready||t.status===Ot.running||t.status===Ot.paused}};n(2489),n(116);const Nt=14,kt=18,Lt=1,wt=100,Dt=.6,Pt=.7,Ut=.6;function Ft({speed:t,condition:s}){const n=t*Dt,e=Pt+s/wt*Ut;return n*e}function Ht(t,s){return t/s*E.TIME_SCALE}function xt(t,s){const n=t.map(t=>{const n=Ft(t),e=Ht(s,n);return{...t,speed:n,time:e}});return n.sort((t,s)=>t.time-s.time),n.map((t,s)=>({...t,place:s+1}))}function It(t,s){return Math.floor(Math.random()*(s-t+1))+t}function $t(t){const s=[...t];for(let n=s.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1)),e=s[n];s[n]=s[t],s[t]=e}return s}const Bt={namespaced:!0,state:()=>({rounds:[]}),mutations:{SET_ROUNDS(t,s){t.rounds=s},SET_RESULT(t,{round:s,result:n}){const e=t.rounds.find(t=>t.round===s);e&&(e.result=n)},SET_ROUND_HORSES(t,{round:s,horses:n}){const e=t.rounds.find(t=>t.round===s);e&&(e.horses=n)},FINISH_ROUND(t,s){const n=t.rounds.find(t=>t.round===s);n&&(n.finished=!0)}},actions:{initRounds({commit:t,rootState:s}){const n=s.horses.list,e=E.ROUND_DISTANCES.map((t,s)=>{const e=$t(n).slice(0,E.HORSES_PER_ROUND);return{round:s+1,distance:t,horses:e,result:null,finished:!1}});t("SET_ROUNDS",e)},runRound({state:t,commit:s},{round:n}){const e=t.rounds.find(t=>t.round===n);if(!e)return;const r=xt(e.horses,e.distance);s("SET_RESULT",{round:n,result:r})}},getters:{roundByNumber:t=>s=>t.rounds.find(t=>t.round===s),currentRoundData:(t,s,n)=>t.rounds.find(t=>t.round===n.game.currentRound),finishedRounds:t=>t.rounds.filter(t=>t.finished)}};n(4114);const Mt=["red","green","yellow","blue","orange","purple","cyan","magenta","lime","pink","teal","lavender","brown","beige","maroon","mint","olive","coral","navy","grey"],Wt=["Thunder","Storm","Blaze","Shadow","Rocket","Comet","Flash","Tornado","Spirit","Ghost","Lightning","Arrow","Fury","Phantom","Rider","Bolt","Wind","Steel","Night","King"];function jt(t,s,n){return{id:t,name:n,color:s,speed:It(Nt,kt),condition:It(Lt,wt)}}const qt={namespaced:!0,state:()=>({list:[]}),mutations:{SET_HORSES(t,s){t.list=s}},actions:{createHorses({commit:t}){const s=[];for(let n=0;n<E.HORSES_TOTAL_COUNT;n++)s.push(jt(n+1,Mt[n%Mt.length],Wt[n%Wt.length]));t("SET_HORSES",s)}}};e.Ay.use(u.Ay);var Gt=new u.Ay.Store({modules:{game:bt,races:Bt,horses:qt}});e.Ay.config.productionTip=!1,new e.Ay({store:Gt,render:t=>t(Et)}).$mount("#app")}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var i=s[e]={exports:{}};return t[e].call(i.exports,i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(s,e,r,i){if(!e){var o=1/0;for(c=0;c<t.length;c++){e=t[c][0],r=t[c][1],i=t[c][2];for(var a=!0,u=0;u<e.length;u++)(!1&i||o>=i)&&Object.keys(n.O).every(function(t){return n.O[t](e[u])})?e.splice(u--,1):(a=!1,i<o&&(o=i));if(a){t.splice(c--,1);var l=r();void 0!==l&&(s=l)}}return s}i=i||0;for(var c=t.length;c>0&&t[c-1][2]>i;c--)t[c]=t[c-1];t[c]=[e,r,i]}}(),function(){n.n=function(t){var s=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(s,{a:s}),s}}(),function(){n.d=function(t,s){for(var e in s)n.o(s,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:s[e]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)}}(),function(){n.p="/horse-racing/"}(),function(){var t={524:0};n.O.j=function(s){return 0===t[s]};var s=function(s,e){var r,i,o=e[0],a=e[1],u=e[2],l=0;if(o.some(function(s){return 0!==t[s]})){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(u)var c=u(n)}for(s&&s(e);l<o.length;l++)i=o[l],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(c)},e=self["webpackChunkhorse_racing"]=self["webpackChunkhorse_racing"]||[];e.forEach(s.bind(null,0)),e.push=s.bind(null,e.push.bind(e))}();var e=n.O(void 0,[504],function(){return n(7034)});e=n.O(e)})();
//# sourceMappingURL=app.f9047909.js.map